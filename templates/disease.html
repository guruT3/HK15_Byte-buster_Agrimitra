{% extends "base.html" %}

{% block title %}Plant Disease Detection â€” AgriMitra{% endblock %}

{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXTRA CSS  â€” greenery theme, farmer-friendly
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{% block extra_css %}
<link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@700&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
/* â”€â”€ Colour tokens (greenery override) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
:root {
    --leaf-dark:   #0e2410;
    --leaf-mid:    #1b4d20;
    --leaf-bright: #2e7d32;
    --leaf-fresh:  #43a047;
    --leaf-light:  #81c784;
    --leaf-pale:   #e8f5e9;
    --soil:        #6d4c41;
    --gold:        #f9a825;
    --white:       #ffffff;
}

/* â”€â”€ Hero section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hero-section {
    position: relative;
    min-height: 92vh;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    text-align: center;
    overflow: hidden;
    padding: 60px 20px 40px;

    /* Animated crop background */
    background-color: var(--leaf-dark);
    background-image: url('../static/images/crop_background1.jpg');
    background-size: cover;
    background-position: center;
    animation: bgSlide 24s ease-in-out infinite;
}

@keyframes bgSlide {
    0%,22%  { background-image: url('../static/images/crop_background1.jpg'); }
    25%,47% { background-image: url('../static/images/crop_background2.jpg'); }
    50%,72% { background-image: url('../static/images/crop_background3.jpg'); }
    75%,97% { background-image: url('../static/images/crop_background4.jpg'); }
    100%    { background-image: url('../static/images/crop_background1.jpg'); }
}

/* dark-green overlay so text is always readable */
.hero-section::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(
        160deg,
        rgba(14,36,16,0.82) 0%,
        rgba(27,77,32,0.72) 50%,
        rgba(14,36,16,0.88) 100%
    );
    backdrop-filter: blur(1.5px);
    z-index: 0;
}

.hero-content {
    position: relative;
    z-index: 1;
    max-width: 720px;
    margin: 0 auto;
    animation: fadeUp 0.7s ease both;
}

@keyframes fadeUp {
    from { opacity: 0; transform: translateY(28px); }
    to   { opacity: 1; transform: translateY(0);    }
}

/* â”€â”€ Hero title â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hero-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: rgba(129,199,132,0.18);
    border: 1px solid rgba(129,199,132,0.4);
    border-radius: 30px;
    padding: 6px 18px;
    font-size: 0.85rem;
    font-weight: 700;
    color: var(--leaf-light);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 20px;
    font-family: 'Nunito', sans-serif;
}

.hero-title {
    font-family: 'Libre Baskerville', serif;
    font-size: clamp(2.2rem, 5vw, 3.8rem);
    font-weight: 700;
    color: var(--white);
    line-height: 1.18;
    text-shadow: 0 4px 24px rgba(0,0,0,0.4);
    margin-bottom: 14px;
}

.hero-title .highlight { color: var(--leaf-light); }

.hero-subtitle {
    font-family: 'Nunito', sans-serif;
    font-size: clamp(1rem, 2vw, 1.2rem);
    color: rgba(255,255,255,0.78);
    margin-bottom: 36px;
    line-height: 1.65;
}

/* â”€â”€ Upload card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.upload-card {
    background: rgba(255,255,255,0.97);
    border-radius: 24px;
    padding: 36px 40px 40px;
    max-width: 500px;
    margin: 0 auto;
    box-shadow: 0 20px 60px rgba(14,36,16,0.45);
    animation: fadeUp 0.85s 0.1s ease both;
}

.upload-card-title {
    font-family: 'Libre Baskerville', serif;
    font-size: 1.3rem;
    color: var(--leaf-bright);
    margin-bottom: 4px;
    font-weight: 700;
}

.upload-card-sub {
    font-family: 'Nunito', sans-serif;
    font-size: 0.88rem;
    color: #777;
    margin-bottom: 22px;
}

/* Drop zone */
.drop-zone {
    border: 2.5px dashed #81c784;
    border-radius: 16px;
    padding: 30px 20px;
    background: var(--leaf-pale);
    cursor: pointer;
    transition: border-color 0.2s, background 0.2s;
    position: relative;
    text-align: center;
}

.drop-zone:hover,
.drop-zone.dragover {
    border-color: var(--leaf-fresh);
    background: #c8e6c9;
}

.drop-zone input[type="file"] {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
    width: 100%;
    height: 100%;
    z-index: 2;
}

.dz-icon  { font-size: 2.8rem; margin-bottom: 8px; }
.dz-label {
    font-family: 'Nunito', sans-serif;
    font-weight: 700;
    font-size: 1rem;
    color: var(--leaf-bright);
    display: block;
    margin-bottom: 4px;
}
.dz-hint  { font-size: 0.8rem; color: #999; font-family: 'Nunito', sans-serif; }

/* Preview */
#preview-container { display: none; margin-top: 14px; }

#preview-img {
    max-height: 160px;
    border-radius: 12px;
    border: 3px solid var(--leaf-light);
    box-shadow: 0 4px 16px rgba(46,125,50,0.2);
    display: block;
    margin: 0 auto;
}

.preview-name {
    margin-top: 6px;
    font-size: 0.82rem;
    color: #666;
    text-align: center;
    font-family: 'Nunito', sans-serif;
}

/* Submit button */
.btn-analyse {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    width: 100%;
    margin-top: 20px;
    padding: 16px 24px;
    background: linear-gradient(135deg, var(--leaf-bright) 0%, var(--leaf-fresh) 100%);
    color: white;
    font-family: 'Nunito', sans-serif;
    font-size: 1.15rem;
    font-weight: 800;
    border: none;
    border-radius: 14px;
    cursor: pointer;
    letter-spacing: 0.5px;
    box-shadow: 0 6px 24px rgba(46,125,50,0.38);
    transition: transform 0.2s, box-shadow 0.2s;
}

.btn-analyse:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 32px rgba(46,125,50,0.5);
}

.btn-analyse .btn-icon { font-size: 1.25rem; }

/* â”€â”€ How it works strip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.how-strip {
    position: relative;
    z-index: 1;
    display: flex;
    justify-content: center;
    gap: 14px;
    padding: 18px 20px 28px;
    flex-wrap: wrap;
}

.how-step {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    color: rgba(255,255,255,0.78);
    font-weight: 600;
    font-family: 'Nunito', sans-serif;
}

.how-step .step-num {
    width: 24px;
    height: 24px;
    background: var(--leaf-bright);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.72rem;
    font-weight: 800;
    color: white;
    flex-shrink: 0;
}

.how-arrow { color: rgba(129,199,132,0.5); font-size: 0.8rem; }

/* â”€â”€ Feature chips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.feature-chips {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    padding: 20px 20px 30px;
    background: rgba(14,36,16,0.55);
}

.chip {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(129,199,132,0.3);
    border-radius: 30px;
    padding: 7px 16px;
    font-family: 'Nunito', sans-serif;
    font-size: 0.85rem;
    font-weight: 600;
    color: rgba(255,255,255,0.82);
}

/* â”€â”€ Result section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.result-section {
    padding: 60px 20px 70px;
    background: var(--leaf-pale);
    animation: fadeUp 0.6s ease both;
}

.result-heading {
    text-align: center;
    font-family: 'Libre Baskerville', serif;
    font-size: 1.7rem;
    color: var(--leaf-bright);
    margin-bottom: 32px;
}

.result-card {
    max-width: 920px;
    margin: 0 auto;
    background: white;
    border-radius: 24px;
    box-shadow: 0 10px 48px rgba(46,125,50,0.15);
    overflow: hidden;
    display: flex;
    flex-wrap: wrap;
}

.result-img-wrap {
    width: 300px;
    min-width: 220px;
    flex-shrink: 0;
    background: var(--leaf-pale);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
}

.result-img-wrap img {
    width: 100%;
    max-height: 280px;
    object-fit: cover;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.12);
}

.result-info {
    flex: 1;
    min-width: 260px;
    padding: 32px 36px;
}

.disease-name {
    font-family: 'Libre Baskerville', serif;
    font-size: 1.65rem;
    color: var(--leaf-bright);
    margin-bottom: 22px;
    line-height: 1.3;
}

/* Info rows â€” large & readable for farmers */
.info-row {
    display: flex;
    gap: 14px;
    align-items: flex-start;
    margin-bottom: 18px;
    background: var(--leaf-pale);
    border-radius: 14px;
    padding: 16px 18px;
}

.info-row .row-icon  { font-size: 1.8rem; flex-shrink: 0; margin-top: 2px; }
.info-row .row-label {
    font-family: 'Nunito', sans-serif;
    font-size: 0.74rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 1.2px;
    color: var(--soil);
    display: block;
    margin-bottom: 5px;
}
.info-row .row-text {
    font-family: 'Nunito', sans-serif;
    font-size: 1rem;
    color: #333;
    line-height: 1.6;
    font-weight: 500;
}

/* Cure row highlighted */
.info-row.cure {
    background: #e8f5e9;
    border-left: 4px solid var(--leaf-fresh);
}
.info-row.cure .row-label { color: var(--leaf-bright); }

/* Action buttons */
.result-actions {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    margin-top: 8px;
}

.btn-scan-again {
    display: inline-flex;
    align-items: center;
    gap: 7px;
    padding: 12px 24px;
    background: var(--leaf-bright);
    color: white;
    border: none;
    border-radius: 12px;
    font-family: 'Nunito', sans-serif;
    font-size: 0.95rem;
    font-weight: 700;
    cursor: pointer;
    text-decoration: none;
    transition: background 0.2s, transform 0.2s;
}
.btn-scan-again:hover { background: var(--leaf-fresh); transform: translateY(-2px); color: white; }

.btn-expert {
    display: inline-flex;
    align-items: center;
    gap: 7px;
    padding: 12px 24px;
    background: white;
    color: var(--soil);
    border: 2px solid #d7ccc8;
    border-radius: 12px;
    font-family: 'Nunito', sans-serif;
    font-size: 0.95rem;
    font-weight: 700;
    cursor: pointer;
    text-decoration: none;
    transition: border-color 0.2s, transform 0.2s;
}
.btn-expert:hover { border-color: var(--soil); transform: translateY(-2px); color: var(--soil); }

/* â”€â”€ Loading overlay â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#loading-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(14,36,16,0.87);
    backdrop-filter: blur(8px);
    z-index: 9999;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 20px;
    color: white;
}
#loading-overlay.active { display: flex; }

.leaf-spinner { position: relative; width: 70px; height: 70px; }
.leaf-spinner .leaf {
    position: absolute;
    width: 52px; height: 52px;
    border-radius: 50% 10% 50% 10%;
    background: linear-gradient(135deg, var(--leaf-fresh), var(--leaf-light));
    animation: spinLeaf 1.4s ease-in-out infinite;
    top: 9px; left: 9px;
}
.leaf-spinner .leaf:nth-child(2) {
    animation-delay: 0.35s;
    opacity: 0.5;
}
@keyframes spinLeaf {
    0%   { transform: rotate(0deg) scale(1); }
    50%  { transform: rotate(180deg) scale(0.72); }
    100% { transform: rotate(360deg) scale(1); }
}

.loading-title {
    font-family: 'Libre Baskerville', serif;
    font-size: 1.3rem;
    color: var(--leaf-light);
}
.loading-tip {
    font-family: 'Nunito', sans-serif;
    font-size: 0.88rem;
    color: rgba(255,255,255,0.55);
    max-width: 300px;
    text-align: center;
    line-height: 1.55;
}

/* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 640px) {
    .upload-card { padding: 24px 18px 26px; }
    .result-img-wrap { width: 100%; }
    .result-info { padding: 22px 18px; }
    .disease-name { font-size: 1.3rem; }
}
</style>
{% endblock %}


{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONTENT BLOCK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{% block content %}

<!-- Loading Overlay -->
<div id="loading-overlay">
    <div class="leaf-spinner">
        <div class="leaf"></div>
        <div class="leaf"></div>
    </div>
    <div class="loading-title">Analysing your plantâ€¦</div>
    <div class="loading-tip">ğŸŒ¿ Our AI checks for 38+ crop diseases. Just a few seconds!</div>
</div>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HERO + UPLOAD FORM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section class="hero-section">
    <div class="hero-content">

        <div class="hero-badge">ğŸ”¬ AI Disease Scanner</div>

        <h1 class="hero-title">
            Is your crop <span class="highlight">sick?</span><br>
            Let's find out â€” fast.
        </h1>

        <p class="hero-subtitle">
            Take a photo of the affected leaf, upload it below, and our AI will tell you
            the <strong style="color:#a5d6a7;">disease, cause, and cure</strong> â€” in seconds.
        </p>

        <!-- Upload card -->
        <div class="upload-card">
            <div class="upload-card-title">ğŸ“· Upload Leaf Photo</div>
            <div class="upload-card-sub">Works best with a clear, close-up photo of the affected leaf</div>

            <form id="upload-form" action="/upload/" method="POST" enctype="multipart/form-data">

                <!-- Drop zone -->
                <div class="drop-zone" id="dropZone">
                    <input type="file" accept="image/png,image/jpeg,image/jpg"
                           name="img" id="img-input" required>
                    <div class="dz-icon" id="dz-icon">ğŸŒ±</div>
                    <span class="dz-label" id="dz-label">Tap here to choose a photo</span>
                    <span class="dz-hint">JPG or PNG &bull; Works with phone camera photos</span>
                </div>

                <!-- Live preview -->
                <div id="preview-container">
                    <img id="preview-img" src="#" alt="Your plant photo">
                    <div class="preview-name" id="preview-name"></div>
                </div>

                <button type="submit" class="btn-analyse">
                    <span class="btn-icon">ğŸ”</span> Scan My Plant
                </button>

            </form>
        </div>

        <!-- How it works -->
        <div class="how-strip">
            <div class="how-step"><div class="step-num">1</div> Take a leaf photo</div>
            <div class="how-arrow">â†’</div>
            <div class="how-step"><div class="step-num">2</div> Upload it here</div>
            <div class="how-arrow">â†’</div>
            <div class="how-step"><div class="step-num">3</div> Get disease + cure instantly</div>
        </div>

    </div>
</section>

<!-- Feature chips -->



<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     RESULT (shown after scan)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
{% if result %}
<section class="result-section" id="result-section">

    <h2 class="result-heading">ğŸŒ¿ Analysis Result</h2>

    <div class="result-card">

        <!-- Plant image -->
        <div class="result-img-wrap">
            <img src="{{ imagepath }}" alt="Your uploaded plant photo">
        </div>

        <!-- Disease info -->
        <div class="result-info">

            <div class="disease-name">{{ prediction['name'] }}</div>

            <!-- Cause row -->
            <div class="info-row">
                <div class="row-icon">ğŸ¦ </div>
                <div class="row-body">
                    <span class="row-label">What is causing this?</span>
                    <span class="row-text">{{ prediction['cause'] }}</span>
                </div>
            </div>

            <!-- Cure row -->
            <div class="info-row cure">
                <div class="row-icon">ğŸ’Š</div>
                <div class="row-body">
                    <span class="row-label">How to treat / cure it?</span>
                    <span class="row-text">{{ prediction['cure'] }}</span>
                </div>
            </div>

            <!-- Action buttons -->
            <div class="result-actions">
                <a href="{{ url_for('disease_detection') }}" class="btn-scan-again">
                    ğŸ”„ Scan Another Plant
                </a>
                <a href="/appoinment" class="btn-expert">
                    ğŸ‘¨â€ğŸŒ¾ Talk to an Expert
                </a>
            </div>

        </div>
    </div>

</section>
{% endif %}

{% endblock %}


{# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXTRA JS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{% block extra_js %}
<script>
/* 1 â€” Live image preview */
const imgInput         = document.getElementById('img-input');
const previewContainer = document.getElementById('preview-container');
const previewImg       = document.getElementById('preview-img');
const previewName      = document.getElementById('preview-name');
const dropZone         = document.getElementById('dropZone');
const dzIcon           = document.getElementById('dz-icon');
const dzLabel          = document.getElementById('dz-label');

imgInput.addEventListener('change', function () {
    const file = this.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
        previewImg.src = e.target.result;
        previewName.textContent = 'ğŸ“ ' + file.name;
        previewContainer.style.display = 'block';
        dzIcon.textContent  = 'âœ…';
        dzLabel.textContent = 'Photo selected â€” looks good!';
    };
    reader.readAsDataURL(file);
});

/* 2 â€” Drag-and-drop support */
dropZone.addEventListener('dragover', e => {
    e.preventDefault();
    dropZone.classList.add('dragover');
});
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('dragover');
    const file = e.dataTransfer.files[0];
    if (file) {
        const dt = new DataTransfer();
        dt.items.add(file);
        imgInput.files = dt.files;
        imgInput.dispatchEvent(new Event('change'));
    }
});

/* 3 â€” Loading overlay on submit */
document.getElementById('upload-form').addEventListener('submit', function () {
    document.getElementById('loading-overlay').classList.add('active');
});

/* 4 â€” Auto-scroll to result if present */
const resultSection = document.getElementById('result-section');
if (resultSection) {
    setTimeout(() => resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' }), 350);
}
</script>
{% endblock %}